{"version":3,"sources":["../../../src/local/activitychooser/dialogue.js"],"names":["showModuleHelp","carousel","moduleData","help","find","selectors","regions","innerHTML","spinnerPromise","transitionPromiseResolver","transitionPromise","Promise","resolve","contentPromise","Templates","renderForPromise","all","then","html","js","replaceNodeContents","querySelector","chooserSummary","description","focus","catch","Notification","exception","one","manageFavouriteState","modalBody","caller","partialFavourite","isFavourite","dataset","favourited","id","name","internal","Repository","unfavouriteModule","favouriteModule","registerListenerEvents","modal","mappedModules","bodyClickListener","e","target","closest","actions","optionActions","showSummary","getBody","module","chooserOption","container","moduleName","modname","get","manageFavourite","matches","closeOption","on","allModules","modules","getModuleSelector","getBodyPromise","body","interval","pause","keyboard","addEventListener","initKeyboardNavigation","favTabNav","favouriteTabNav","recommendedTabNav","defaultTabNav","forEach","element","firstLink","parentElement","firstElementChild","lastLink","lastElementChild","keyCode","arrowRight","nextLink","nextElementSibling","srcElement","tabIndex","classList","contains","arrowLeft","previousLink","previousElementSibling","home","end","space","preventDefault","click","chooserOptions","querySelectorAll","Array","from","document","enter","currentOption","nextOption","firstOption","toFocusOption","clickErrorHandler","focusChooserOption","previousOption","lastOption","currentChooserOption","previousChooserOption","previousChooserOptionLink","addChooser","previousChooserOptionHelp","previousChooserOptionFavourite","currentChooserOptionLink","currentChooserOptionHelp","currentChooserOptionFavourite","item","fallback","displayChooser","origin","sectionModules","Map","set","componentname","link","getRoot","ModalEvents","hidden","destroy","shown","getModal","firstChooserOption","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A type of dialogue used as for choosing options.\n *\n * @module     core_course/local/chooser/dialogue\n * @package    core\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport * as ModalEvents from 'core/modal_events';\nimport selectors from 'core_course/local/activitychooser/selectors';\nimport * as Templates from 'core/templates';\nimport {end, arrowLeft, arrowRight, home, enter, space} from 'core/key_codes';\nimport {addIconToContainer} from 'core/loadingicon';\nimport * as Repository from 'core_course/local/activitychooser/repository';\nimport Notification from 'core/notification';\n\n/**\n * Given an event from the main module 'page' navigate to it's help section via a carousel.\n *\n * @method showModuleHelp\n * @param {jQuery} carousel Our initialized carousel to manipulate\n * @param {Object} moduleData Data of the module to carousel to\n */\nconst showModuleHelp = (carousel, moduleData) => {\n    const help = carousel.find(selectors.regions.help)[0];\n    help.innerHTML = '';\n\n    // Add a spinner.\n    const spinnerPromise = addIconToContainer(help);\n\n    // Used later...\n    let transitionPromiseResolver = null;\n    const transitionPromise = new Promise(resolve => {\n        transitionPromiseResolver = resolve;\n    });\n\n    // Build up the html & js ready to place into the help section.\n    const contentPromise = Templates.renderForPromise('core_course/chooser_help', moduleData);\n\n    // Wait for the content to be ready, and for the transition to be complet.\n    Promise.all([contentPromise, spinnerPromise, transitionPromise])\n        .then(([{html, js}]) => Templates.replaceNodeContents(help, html, js))\n        .then(() => {\n            help.querySelector(selectors.regions.chooserSummary.description).focus();\n            return help;\n        })\n        .catch(Notification.exception);\n\n    // Move to the next slide, and resolve the transition promise when it's done.\n    carousel.one('slid.bs.carousel', () => {\n        transitionPromiseResolver();\n    });\n    // Trigger the transition between 'pages'.\n    carousel.carousel('next');\n};\n\n/**\n * Given a user wants to change the favourite state of a module we either add or remove the status.\n * We also propergate this change across our map of modals.\n *\n * @method manageFavouriteState\n * @param {HTMLElement} modalBody The DOM node of the modal to manipulate\n * @param {HTMLElement} caller\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\n */\nconst manageFavouriteState = async(modalBody, caller, partialFavourite) => {\n    const isFavourite = caller.dataset.favourited;\n    const id = caller.dataset.id;\n    const name = caller.dataset.name;\n    const internal = caller.dataset.internal;\n    // Switch on fave or not.\n    if (isFavourite === 'true') {\n        await Repository.unfavouriteModule(name, id);\n\n        partialFavourite(internal, false, modalBody);\n    } else {\n        await Repository.favouriteModule(name, id);\n\n        partialFavourite(internal, true, modalBody);\n    }\n\n};\n\n/**\n * Register chooser related event listeners.\n *\n * @method registerListenerEvents\n * @param {Promise} modal Our modal that we are working with\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\n */\nconst registerListenerEvents = (modal, mappedModules, partialFavourite) => {\n    const bodyClickListener = e => {\n        if (e.target.closest(selectors.actions.optionActions.showSummary)) {\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\n\n            const module = e.target.closest(selectors.regions.chooserOption.container);\n            const moduleName = module.dataset.modname;\n            const moduleData = mappedModules.get(moduleName);\n            showModuleHelp(carousel, moduleData);\n        }\n\n        if (e.target.closest(selectors.actions.optionActions.manageFavourite)) {\n            const caller = e.target.closest(selectors.actions.optionActions.manageFavourite);\n            manageFavouriteState(modal.getBody()[0], caller, partialFavourite);\n        }\n\n        // From the help screen go back to the module overview.\n        if (e.target.matches(selectors.actions.closeOption)) {\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\n\n            // Trigger the transition between 'pages'.\n            carousel.carousel('prev');\n            carousel.on('slid.bs.carousel', () => {\n                const allModules = modal.getBody()[0].querySelector(selectors.regions.modules);\n                const caller = allModules.querySelector(selectors.regions.getModuleSelector(e.target.dataset.modname));\n                caller.focus();\n            });\n        }\n    };\n\n    modal.getBodyPromise()\n\n    // The return value of getBodyPromise is a jquery object containing the body NodeElement.\n    .then(body => body[0])\n\n    // Set up the carousel.\n    .then(body => {\n        $(body.querySelector(selectors.regions.carousel))\n            .carousel({\n                interval: false,\n                pause: true,\n                keyboard: false\n            });\n\n        return body;\n    })\n\n    // Add the listener for clicks on the body.\n    .then(body => {\n        body.addEventListener('click', bodyClickListener);\n        return body;\n    })\n\n    // Register event listeners related to the keyboard navigation controls.\n    .then(body => {\n        initKeyboardNavigation(body, mappedModules);\n        return body;\n    })\n    .catch();\n\n};\n\n/**\n * Initialise the keyboard navigation controls for the chooser.\n *\n * @method initKeyboardNavigation\n * @param {HTMLElement} body Our modal that we are working with\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n */\nconst initKeyboardNavigation = (body, mappedModules) => {\n\n    // Set up the tab handlers.\n    const favTabNav = body.querySelector(selectors.regions.favouriteTabNav);\n    const recommendedTabNav = body.querySelector(selectors.regions.recommendedTabNav);\n    const defaultTabNav = body.querySelector(selectors.regions.defaultTabNav);\n    const tabNavArray = [favTabNav, recommendedTabNav, defaultTabNav];\n    tabNavArray.forEach((element) => {\n        return element.addEventListener('keyup', (e) => {\n            const firstLink = e.target.parentElement.parentElement.firstElementChild.firstElementChild;\n            const lastLink = e.target.parentElement.parentElement.lastElementChild.firstElementChild;\n\n            if (e.keyCode === arrowRight) {\n                const nextLink = e.target.parentElement.nextElementSibling;\n                if (nextLink === null) {\n                    e.srcElement.tabIndex = -1;\n                    firstLink.tabIndex = 0;\n                    firstLink.focus();\n                } else if (nextLink.firstElementChild.classList.contains('d-none')) {\n                    e.srcElement.tabIndex = -1;\n                    lastLink.tabIndex = 0;\n                    lastLink.focus();\n                } else {\n                    e.srcElement.tabIndex = -1;\n                    nextLink.firstElementChild.tabIndex = 0;\n                    nextLink.firstElementChild.focus();\n                }\n            }\n            if (e.keyCode === arrowLeft) {\n                const previousLink = e.target.parentElement.previousElementSibling;\n                if (previousLink === null) {\n                    e.srcElement.tabIndex = -1;\n                    lastLink.tabIndex = 0;\n                    lastLink.focus();\n                } else if (previousLink.firstElementChild.classList.contains('d-none')) {\n                    e.srcElement.tabIndex = -1;\n                    firstLink.tabIndex = 0;\n                    firstLink.focus();\n                } else {\n                    e.srcElement.tabIndex = -1;\n                    previousLink.firstElementChild.tabIndex = 0;\n                    previousLink.firstElementChild.focus();\n                }\n            }\n            if (e.keyCode === home) {\n                e.srcElement.tabIndex = -1;\n                firstLink.tabIndex = 0;\n                firstLink.focus();\n            }\n            if (e.keyCode === end) {\n                e.srcElement.tabIndex = -1;\n                lastLink.tabIndex = 0;\n                lastLink.focus();\n            }\n            if (e.keyCode === space) {\n                e.preventDefault();\n                e.target.click();\n            }\n        });\n    });\n\n    // Set up the handlers for the modules.\n    const chooserOptions = body.querySelectorAll(selectors.regions.chooserOption.container);\n\n    Array.from(chooserOptions).forEach((element) => {\n        return element.addEventListener('keyup', (e) => {\n            const chooserOptions = document.querySelector(selectors.regions.chooserOptions);\n\n            // Check for enter/ space triggers for showing the help.\n            if (e.keyCode === enter || e.keyCode === space) {\n                if (e.target.matches(selectors.actions.optionActions.showSummary)) {\n                    e.preventDefault();\n                    const module = e.target.closest(selectors.regions.chooserOption.container);\n                    const moduleName = module.dataset.modname;\n                    const moduleData = mappedModules.get(moduleName);\n                    const carousel = $(body.querySelector(selectors.regions.carousel));\n                    carousel.carousel({\n                        interval: false,\n                        pause: true,\n                        keyboard: false\n                    });\n                    showModuleHelp(carousel, moduleData);\n                }\n            }\n\n            // Next.\n            if (e.keyCode === arrowRight) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const nextOption = currentOption.nextElementSibling;\n                const firstOption = chooserOptions.firstElementChild;\n                const toFocusOption = clickErrorHandler(nextOption, firstOption);\n                focusChooserOption(toFocusOption, currentOption);\n            }\n\n            // Previous.\n            if (e.keyCode === arrowLeft) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const previousOption = currentOption.previousElementSibling;\n                const lastOption = chooserOptions.lastElementChild;\n                const toFocusOption = clickErrorHandler(previousOption, lastOption);\n                focusChooserOption(toFocusOption, currentOption);\n            }\n\n            if (e.keyCode === home) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const firstOption = chooserOptions.firstElementChild;\n                focusChooserOption(firstOption, currentOption);\n            }\n\n            if (e.keyCode === end) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const lastOption = chooserOptions.lastElementChild;\n                focusChooserOption(lastOption, currentOption);\n            }\n        });\n    });\n};\n\n/**\n * Focus on a chooser option element and remove the previous chooser element from the focus order\n *\n * @method focusChooserOption\n * @param {HTMLElement} currentChooserOption The current chooser option element that we want to focus\n * @param {HTMLElement} previousChooserOption The previous focused option element\n */\nconst focusChooserOption = (currentChooserOption, previousChooserOption = false) => {\n    if (previousChooserOption !== false) {\n        const previousChooserOptionLink = previousChooserOption.querySelector(selectors.actions.addChooser);\n        const previousChooserOptionHelp = previousChooserOption.querySelector(selectors.actions.optionActions.showSummary);\n        const previousChooserOptionFavourite = previousChooserOption.querySelector(selectors.actions.optionActions.manageFavourite);\n        // Set tabindex to -1 to remove the previous chooser option element from the focus order.\n        previousChooserOption.tabIndex = -1;\n        previousChooserOptionLink.tabIndex = -1;\n        previousChooserOptionHelp.tabIndex = -1;\n        previousChooserOptionFavourite.tabIndex = -1;\n    }\n\n    const currentChooserOptionLink = currentChooserOption.querySelector(selectors.actions.addChooser);\n    const currentChooserOptionHelp = currentChooserOption.querySelector(selectors.actions.optionActions.showSummary);\n    const currentChooserOptionFavourite = currentChooserOption.querySelector(selectors.actions.optionActions.manageFavourite);\n    // Set tabindex to 0 to add current chooser option element to the focus order.\n    currentChooserOption.tabIndex = 0;\n    currentChooserOptionLink.tabIndex = 0;\n    currentChooserOptionHelp.tabIndex = 0;\n    currentChooserOptionFavourite.tabIndex = 0;\n    // Focus the current chooser option element.\n    currentChooserOption.focus();\n};\n\n/**\n * Small error handling function to make sure the navigated to object exists\n *\n * @method clickErrorHandler\n * @param {HTMLElement} item What we want to check exists\n * @param {HTMLElement} fallback If we dont match anything fallback the focus\n * @return {String}\n */\nconst clickErrorHandler = (item, fallback) => {\n    if (item !== null) {\n        return item;\n    } else {\n        return fallback;\n    }\n};\n\n/**\n * Display the module chooser.\n *\n * @method displayChooser\n * @param {HTMLElement} origin The calling button\n * @param {Object} modal Our created modal for the section\n * @param {Array} sectionModules An array of all of the built module information\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\n */\nexport const displayChooser = (origin, modal, sectionModules, partialFavourite) => {\n\n    // Make a map so we can quickly fetch a specific module's object for either rendering or searching.\n    const mappedModules = new Map();\n    sectionModules.forEach((module) => {\n        mappedModules.set(module.componentname + '_' + module.link, module);\n    });\n\n    // Register event listeners.\n    registerListenerEvents(modal, mappedModules, partialFavourite);\n\n    // We want to focus on the action select when the dialog is closed.\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n\n    // We want to focus on the first chooser option element as soon as the modal is opened.\n    modal.getRoot().on(ModalEvents.shown, () => {\n        modal.getModal()[0].tabIndex = -1;\n\n        modal.getBodyPromise()\n        .then(body => {\n            const firstChooserOption = body[0].querySelector(selectors.regions.chooserOption.container);\n            focusChooserOption(firstChooserOption);\n\n            return;\n        })\n        .catch(Notification.exception);\n    });\n\n    modal.show();\n};\n"],"file":"dialogue.min.js"}